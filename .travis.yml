sudo: required
language: node_js
node_js:
  - "8"

services:
  - docker

cache: yarn
install: yarn

before_script:
  # workaround as travis use ubuntu/trusty which has mysql
  - sudo /etc/init.d/mysql stop

script: 
  # run yarn test and link
  - yarn test
  - yarn link
  # run intergration tests in docker
  - cd ./tests
  - source ./env.sh
  - echo $MYSQL_DATABASE
  - echo $MYSQL_USER
  - docker-compose up -d
  - ./wait_for_db.sh
  - docker exec sql-mariadb mysql -utest -ptest -e "show databases;"
  - sql2realm ./config.json
